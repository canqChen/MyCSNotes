# Zookeeper

## Zookeeper简介

### Zookeeper是什么？

* Zookeeper是一个分布式协调服务的开源框架，**主要用来解决分布式集群中应用系统的一致性问题**，例如怎样避免同时操作同一数据造成脏读问题
* Zookeeper本质是一个分布式的小文件存储系统。提供基于类似于文件系统的目录树方式的数据存储，并且可以对树中的节点进行有效管理
* Zookeeper提供给**客户端监控存储在zk内部数据的功能**，从而可以达到基于数据的集群管理，诸如：统一命名服务(dubbo)、分布式配置管理(solr的配置集中管理)、分布式消息队列(sub/pub)、分布式锁、分布式协调等功能

### Zookeeper的架构组成

* Zookeeper也是Master/Slave架构，但是Zookeeper集群中的Leader不是指定而来，而是通过选举产生
* Leader
  * Zookeeper集群工作的核心角色
  * 集群内部各个服务器的调度者
  * 事务请求(写操作)的唯一调度和处理者，保证集群事务处理的顺序性；对于create，setData、delete等有写操作的请求，**则需要统一转发给leader处理，leader需要决定编号，执行操作，这个过程称为一个事务**
* Follower
  * 处理客户端非事务(读操作)请求
  * 转发事务请求给Leader
  * 参与集群Leader选举投票，2n-1台可以做集群投票
* Observer
  * 为访问量表较大的集群增设
  * 观察者角色，观察Zookeeper集群的最新状态变化并将这些状态同步过来，其对于非事务请求可以进行独立处理，对于事务请求，则会转发给Leader服务器进行处理
  * 不会参与任何形式的投票只提供非事物服务，通常用于在不影响集群事务处理能力的前提下提升集群的非事务处理能力。增加了集群并发的读请求

### ZooKeeper特点

* ZooKeeper：一个领导者(leader)，多个跟随者(follower)组成的集群
* leader负责投票的发起和决议，更新系统状态(内部原理)
* follower用于接受客户请求并向客户端返回结果，在选举leader过程中参与投票
* 集群中只要有**半数以上节点存活，ZooKeeper集群就能正常服务**
* **全局数据一致**：每个server保存一份相同的数据副本，client无论连接到哪个server，数据都是一致的
* 更新请求顺序进行(内部原理)
* 数据更新原子性，一次数据更新要么成功，要么失败

## ZooKeeper环境搭建

#### ZooKeeper搭建方式

ZooKeeper安装方式有三种，单机模式、集群模式及伪集群模式

* 单机模式：ZooKeeper只运行在一台服务器上，适合测试环境
* 伪集群模式：就是在一台服务器上运行多个ZooKeeper实例
* 集群模式：ZooKeeper运行于一个集群上，适合生产环境，这个计算机集群被称为一个”集合体“

